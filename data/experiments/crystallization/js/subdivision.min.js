(function(){var e,t,n,r,i=[].slice;t=function(){function e(e,t){this.x=e!=null?e:0,this.y=t!=null?t:0}return e.prototype.distanceSq=function(e){var t,n;return(t=e.x-this.x)*t+(n=e.y-this.y)*n},e.prototype.distance=function(e){var t,n;return sqrt((t=e.x-this.x)*t+(n=e.y-this.y)*n)},e.prototype.angle=function(e){return atan2(e.y-this.y,e.x-this.x)},e.prototype.lerp=function(t,n){return new e(this.x+(t.x-this.x)*n,this.y+(t.y-this.y)*n)},e.prototype.clone=function(){return new e(this.x,this.y)},e}(),e=function(){function e(){var e;e=1<=arguments.length?i.call(arguments,0):[],this.vertices=e,this.generation=0}return e.prototype.subdivide=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d;t==null&&(t=0),n==null&&(n=.5),f=this.vertices.length,r=~~random(f),i=random()<n?~~(r+f/2)%f:~~random(f);while(i===r)i=~~random(f);u=.5+random(t*-0.5,t*.5),a=.5+random(t*-0.5,t*.5),h=this.vertices[r].lerp(this.vertices[(r+1)%f],u),p=this.vertices[i].lerp(this.vertices[(i+1)%f],a),d=[r,i],s=d[0],o=d[1],l=new e(h);while(s!==i)l.vertices.push(this.vertices[s=(s+1)%f]);l.vertices.push(p),c=new e(p);while(o!==r)c.vertices.push(this.vertices[o=(o+1)%f]);return c.vertices.push(h),l.generation=this.generation+1,c.generation=this.generation+1,[l,c]},e.prototype.centroid=function(){var e,n,r,i,s,o;e=n=0,o=this.vertices;for(i=0,s=o.length;i<s;i++)r=o[i],e+=r.x,n+=r.y;return new t(e/this.vertices.length,n/this.vertices.length)},e.prototype.minAngle=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;l=function(e,t,n){return Math.acos((e*e+t*t-n*n)/(2*e*t))},c=Number.MAX_VALUE,u=this.vertices.length,v=this.vertices;for(o=p=0,d=v.length;p<d;o=++p)h=v[o],f=this.vertices[(o-1+u)%u],a=this.vertices[(o+1+u)%u],r=f.distance(h),i=a.distance(h),s=a.distance(f),e=l(i,s,r),t=l(s,r,i),n=Math.PI-e-t,c=min(c,n);return c},e.prototype.minSide=function(){var e,t,n,r,i,s;t=Number.MAX_VALUE,e=this.vertices[this.vertices.length-1],s=this.vertices;for(r=0,i=s.length;r<i;r++)n=s[r],t=min(t,n.distanceSq(e)),e=n;return sqrt(t)},e.prototype.perimeter=function(){var e;return e=this.vertices[0].distance(this.vertices[this.vertices.length-1]),this.vertices.reduce(function(t,n){return e+=t.distance(n),t=n}),e},e.prototype.draw=function(e){var t,n,r,i;e.fillStyle="#fff",e.strokeStyle="#000",e.lineWidth=.5,e.beginPath(),t=this.vertices[0],e.moveTo(t.x,t.y),i=this.vertices;for(n=0,r=i.length;n<r;n++)t=i[n],e.lineTo(t.x,t.y);return e.closePath(),e.fill(),e.stroke()},e}(),r=Sketch.create({settings:{iterations:50,randomness:.25,opposite:.1,minAngle:.4,minSide:2},polygons:[],container:document.getElementById("container"),autoclear:!1,interval:1,setup:function(){return this.reset()},step:function(){var e,t,n,r,i,s,o,u,a,f;t=~~random(this.polygons.length-1),r=this.polygons[t].subdivide(this.settings.randomness,this.settings.opposite);for(i=0,u=r.length;i<u;i++){n=r[i];if(n.minAngle()<this.settings.minAngle){e=!0;break}}for(s=0,a=r.length;s<a;s++){n=r[s];if(n.minSide()<this.settings.minSide){e=!0;break}}if(e==null){for(o=0,f=r.length;o<f;o++)n=r[o],this.polygons.push(n),n.draw(this);return this.polygons.splice(t,1)}},reset:function(){var n,r,i,s;return n=new t(0,0),r=new t(this.width,0),i=new t(this.width,this.height),s=new t(0,this.height),this.polygons=[new e(n,r,i,s)],this.clear()},toggle:function(){return(this.running?this.stop:this.start)()},draw:function(){var e,t,n,r;r=[];for(e=t=0,n=this.settings.iterations;0<=n?t<=n:t>=n;e=0<=n?++t:--t)r.push(this.step());return r},save:function(){return window.open(this.canvas.toDataURL(),"subdivide","top=20,left=20,width="+this.width+",height="+this.height)}}),n=new dat.GUI,n.add(r.settings,"minSide").min(0).max(100).name("min side length"),n.add(r.settings,"minAngle").min(0).max(1.2).step(.01).name("min angle (rad)"),n.add(r.settings,"iterations").min(1).max(100),n.add(r.settings,"randomness").min(0).max(1).step(.01),n.add(r.settings,"opposite").min(0).max(1).step(.01).name("opposite sides"),n.add(r,"toggle").name("start / stop"),n.add(r,"reset").name("reset polygons"),n.add(r,"clear").name("clear canvas"),n.add(r,"save").name("save")}).call(this);