function Particle(e,t,n){this.x=e||0,this.y=t||0,this.ox=this.x,this.oy=this.y,this.mass=n||1,this.massInv=1/this.mass,this.fixed=!1,this.update=function(e){if(!this.fixed){var t=0,n=0,r=this.x,i=this.y;this.x+=this.x-this.ox+t*this.massInv*e*e,this.y+=this.y-this.oy+n*this.massInv*e*e,this.ox=r,this.oy=i}}}function Spring(e,t,n,r){this.p1=e,this.p2=t,this.restLength=n||10,this.strength=r||1,this.update=function(n){var r=t.x-e.x,i=t.y-e.y,s=Math.sqrt(r*r+i*i)+1e-4,o=(s-this.restLength)/(s*(e.massInv+t.massInv))*this.strength,u;e.fixed||(u=o*e.massInv,e.x+=r*u,e.y+=i*u),t.fixed||(u=-o*t.massInv,t.x+=r*u,t.y+=i*u)}}function Sim(){this.particles=[],this.springs=[],this.tick=function(e){var t,n;for(t=0,n=this.springs.length;t<n;++t)this.springs[t].update(e);for(t=0,n=this.particles.length;t<n;++t)this.particles[t].update(e)}}function init(){var e,t,n,r,i=STEP,o=LENGTH,u=o/i,a=canvas.width*.5,f=canvas.height*.5;for(var l=0;l<u;++l)e=new Particle(a+(Math.random()-.5)*200,f+(Math.random()-.5)*200,.1+Math.random()*.01),sim.particles.push(e),l>0&&(s=new Spring(e,t,i,.95),sim.springs.push(s)),t=e;r=sim.particles[0],r.x=50,r.y=50,n=sim.particles[u-1],n.fixed=!0,canvas.addEventListener("mousemove",function(e){n.x=e.clientX,n.y=e.clientY})}function step(e){e=e||+(new Date);var t=e-old;sim.tick(t),canvas.width=canvas.width;var n=[],i=[],s,o,u,a,f,l,c,h,p,d,v;for(s=0,o=sim.particles.length-1;s<o;++s)u=sim.particles[s],a=sim.particles[s+1],f=a.x-u.x,l=a.y-u.y,c=u.x+f*.5,h=u.y+l*.5,n[s]={x:c,y:h},i[s]=Math.atan2(l,f);context.beginPath();for(s=0,o=n.length;s<o;++s)u=sim.particles[s],a=n[s],v=i[s],r=Math.sin(s/o*Math.PI)*THICKNESS,p=Math.sin(v-HALF_PI)*r,d=Math.cos(v-HALF_PI)*r,context.quadraticCurveTo(u.x+d,u.y+p,a.x+d,a.y+p);for(s=n.length-1;s>=0;--s)u=sim.particles[s+1],a=n[s],v=i[s],r=Math.sin(s/o*Math.PI)*THICKNESS,p=Math.sin(v+HALF_PI)*r,d=Math.cos(v+HALF_PI)*r,context.quadraticCurveTo(u.x+d,u.y+p,a.x+d,a.y+p);context.strokeStyle="rgba(255,255,255,0.1)",context.lineWidth=8,context.stroke(),context.strokeStyle="rgba(0,0,0,0.8)",context.lineWidth=.5,context.stroke(),context.fillStyle="rgba(255,255,255,0.9)",context.fill(),old=e,requestAnimationFrame(step)}function resize(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}(function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var TWO_PI=Math.PI*2,HALF_PI=Math.PI*.5,THICKNESS=12,LENGTH=10,STEP=.1,FPS=1e3/60,sim=new Sim,old=(new Date).getTime(),canvas=document.getElementById("world"),context=canvas.getContext("2d");window.addEventListener("resize",resize),resize(),init(),step()